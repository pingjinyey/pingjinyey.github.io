{{/* Hugo Blox: Slider (Tailwind, fullscreen hero style) */}}
{{- $page := .wcPage -}}
{{- $block := .wcBlock -}}
{{- $hash := .wcIdentifier -}}
{{- $slides := $block.content.slides | default (slice) -}}
{{- $count := len $slides -}}

{{- $isFullscreen := $block.design.is_fullscreen | default false -}}
{{- $slideHeight := $block.design.slide_height | default "" -}}
{{- $autoPlay := $block.design.auto_play | default false -}}
{{- $interval := $block.design.interval_ms | default 5000 -}}

{{- $containerStyle := "" -}}
{{- if $slideHeight -}}
  {{- $containerStyle = printf "height:%s;" $slideHeight -}}
{{- else if $isFullscreen -}}
  {{- $containerStyle = "height:100vh;" -}}
{{- else -}}
  {{- $containerStyle = "height:60vh;" -}}
{{- end -}}

{{- /* 外层 section：全屏时冲出页面容器，实现真正全宽 */ -}}
{{- $sectionClass := cond $isFullscreen
    "relative w-screen max-w-none left-1/2 right-1/2 -ml-[50vw] -mr-[50vw]"
    "relative" -}}

{{- /* 内层容器：全屏去掉圆角背景色，只留纯黑底 */ -}}
{{- $outerClass := cond $isFullscreen
    "relative w-full h-screen overflow-hidden bg-black"
    "relative w-full overflow-hidden rounded-2xl bg-gray-100 dark:bg-gray-900" -}}

<section id="{{ $hash }}"
         class="{{ $sectionClass }} {{ $block.design.css_class }} outline-none focus:outline-none focus-visible:outline-none"
         data-hbx-slider
         data-auto-play="{{ cond $autoPlay "true" "false" }}"
         data-interval="{{ $interval }}">
  <div class="{{ $outerClass }}" style="{{ $containerStyle | safeCSS }}">
    <!-- 轨道 -->
    <div class="absolute inset-0">
      {{- range $idx, $item := $slides -}}
        {{- $styleBg := "" -}}
        {{- $styleFilter := "" -}}
        {{- $bg := $item.background -}}

        {{- with $bg.color -}}
          {{- $styleBg = printf "%s background-color:%s;" $styleBg (. | default "transparent") -}}
        {{- end -}}

        {{- if and $bg.gradient_start $bg.gradient_end -}}
          {{- $angle := (string $bg.gradient_angle) | default "90" -}}
          {{- $styleBg = printf "%s background-image:linear-gradient(%sdeg,%s,%s);" $styleBg $angle $bg.gradient_start $bg.gradient_end -}}
        {{- end -}}

        {{- $imgURL := "" -}}
        {{- with $bg.image.filename -}}
          {{- $fname := . -}}
          {{- $res := resources.Get (printf "media/%s" $fname) -}}
          {{- if $res -}}
            {{- $imgURL = $res.RelPermalink -}}
            {{- $pos := $bg.image.position | default "center" -}}
            {{- $size := $bg.image.size | default "cover" -}}
            {{- $styleBg = printf "%s background-image:url('%s'); background-repeat:no-repeat; background-position:%s; background-size:%s;" $styleBg $imgURL $pos $size -}}
          {{- else -}}
            {{- warnf "slider-tw: NOT FOUND assets/media/%s (check path/case/extension)" $fname -}}
          {{- end -}}
          {{- with $bg.image.filters.brightness -}}
            {{- $styleFilter = printf "%s filter:brightness(%s);" $styleFilter (string .) -}}
          {{- end -}}
        {{- end -}}

        <!-- 单张 slide：纯背景图，不带文字 -->
        <div
          class="hbxtw-slide absolute inset-0 z-10 transition-transform duration-500 ease-out
                 {{ if eq $idx 0 }}opacity-100 translate-x-0 pointer-events-auto{{ else }}opacity-0 translate-x-full pointer-events-none hidden{{ end }}"
          style="{{ printf "%s %s" $styleBg $styleFilter | safeCSS }} display:block;">
        </div>
      {{- end -}}
    </div>

    {{ if gt $count 1 }}
      <!-- 底部中间：分页条（细长条） -->
      <div class="absolute bottom-6 left-1/2 z-50 flex -translate-x-1/2 items-center gap-3 pointer-events-auto">
        {{ range $i, $_ := $slides }}
          <button
            class="h-[3px] w-8 rounded-full bg-white/40 dark:bg-white/30 transition
                   data-[active=true]:bg-white data-[active=true]:dark:bg-white data-[active=true]:w-10"
            data-indicator="{{ $i }}"
            aria-label="Go to slide {{ add $i 1 }}"></button>
        {{ end }}
      </div>

      <!-- 右下角：当前编号 -->
      <div class="absolute bottom-6 right-6 z-50 text-white/90 text-xs tracking-[0.18em] uppercase">
        <span data-counter>1</span>/{{ $count }}
      </div>

      <!-- 左右箭头：简洁圆形按钮 -->
      <button
        class="absolute left-4 top-1/2 -translate-y-1/2 z-50 hidden md:flex h-10 w-10 items-center justify-center rounded-full bg-black/30 text-white hover:bg-black/50 transition pointer-events-auto"
        data-prev aria-label="Previous">
        <svg viewBox="0 0 20 20" width="18" height="18" fill="currentColor">
          <path d="M12.7 15.3a1 1 0 0 1-1.4 0l-4-4a1 1 0 0 1 0-1.4l4-4a1 1 0 1 1 1.4 1.4L9.42 10l3.3 3.3a1 1 0 0 1 0 1.4Z"/>
        </svg>
      </button>
      <button
        class="absolute right-4 top-1/2 -translate-y-1/2 z-50 hidden md:flex h-10 w-10 items-center justify-center rounded-full bg-black/30 text-white hover:bg-black/50 transition pointer-events-auto"
        data-next aria-label="Next">
        <svg viewBox="0 0 20 20" width="18" height="18" fill="currentColor">
          <path d="M7.3 15.3a1 1 0 0 0 1.4 0l4-4a1 1 0 0 0 0-1.4l-4-4A1 1 0 1 0 7.3 6.7L10.58 10l-3.3 3.3a1 1 0 0 0 0 1.4Z"/>
        </svg>
      </button>
    {{ end }}

    {{/* 外部 JS */}}
    {{ $js := resources.Get "js/blocks/slider-tw.js" | js.Build | fingerprint }}
    <script src="{{ $js.RelPermalink }}" defer></script>
  </div>
</section>