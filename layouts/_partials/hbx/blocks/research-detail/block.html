{{/* Hugo Blox: Research Detail Block (Redesigned Section Header) */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

  {{/* Part 1: 总体介绍 */}}
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center mb-24">
    
    {{/* 左侧：文本介绍 */}}
    <div class="order-2 lg:order-1">
      <h1 class="text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6 leading-tight tracking-tight">
        {{ $block.content.title }}
      </h1>
      <div class="h-1.5 w-24 bg-primary-600 mb-8 rounded-full"></div>
      
      <div class="prose prose-lg dark:prose-invert text-gray-700 dark:text-gray-300 leading-relaxed">
        {{ $block.content.text | emojify | $page.RenderString }}
      </div>
    </div>

    {{/* 右侧：主图 (智能查找逻辑) */}}
    <div class="order-1 lg:order-2">
      {{ $imgName := $block.content.image }}
      {{ $mainImg := "" }}
      {{/* 1. Page Resource */}}
      {{ $mainImg = $page.Resources.GetMatch $imgName }}
      {{/* 2. Global Resource */}}
      {{ if not $mainImg }}
        {{ $mainImg = resources.Get (printf "media/%s" $imgName) }}
      {{ end }}

      {{ if $mainImg }}
        <div class="relative rounded-2xl overflow-hidden shadow-2xl border-4 border-white dark:border-gray-800 transform rotate-1 hover:rotate-0 transition-transform duration-500">
           <img src="{{ $mainImg.RelPermalink }}" alt="Research Highlight" class="w-full h-auto">
        </div>
      {{ else }}
        <div class="w-full h-64 bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-400 border-2 border-dashed border-gray-300 rounded-2xl">
           Image not found: {{ $imgName }}
        </div>
      {{ end }}
    </div>
  </div>

  {{/* Part 2: 细分方向/成果展示 */}}
  {{ if $block.content.features }}
  <div class="relative">
    
    {{/* ================= 修改点：重新设计的小标题 ================= */}}
    {{/* 采用与大标题一致的左对齐 + 装饰线风格，但尺寸稍小 (h2, h-1 w-16) */}}
    <div class="mb-12">
       <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-4 tracking-tight">
         Key Directions and Achievements
       </h2>
       <div class="h-1 w-16 bg-primary-600 rounded-full"></div>
    </div>
    {{/* ========================================================== */}}

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {{ range $block.content.features }}
        <div class="bg-white dark:bg-slate-800 rounded-xl p-8 shadow-lg border-t-4 border-primary-600 hover:-translate-y-2 transition-transform duration-300 flex flex-col">
           
           {{/* 图标或小图 */}}
           {{ if .icon }}
             <div class="w-14 h-14 bg-primary-50 dark:bg-primary-900/30 rounded-xl flex items-center justify-center mb-6 text-primary-600 dark:text-primary-400 flex-shrink-0">
               {{ partial "functions/get_icon" (dict "name" .icon "attributes" "class=\"w-8 h-8\"") }}
             </div>
           {{ else if .image }}
             <div class="w-full h-48 mb-6 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700 flex-shrink-0">
                {{/* 子图片智能查找 */}}
                {{ $featImgName := .image }}
                {{ $featImg := $page.Resources.GetMatch $featImgName }}
                {{ if not $featImg }}
                  {{ $featImg = resources.Get (printf "media/%s" $featImgName) }}
                {{ end }}

                {{ if $featImg }}
                  {{/* 优化：使用 fill 裁剪以保证网格整齐 */}}
                  {{ $featImgResized := $featImg.Fill "600x400 Center webp" }}
                  <img src="{{ $featImgResized.RelPermalink }}" class="w-full h-full object-cover">
                {{ else }}
                  <div class="w-full h-full flex items-center justify-center text-xs text-gray-400">Image not found</div>
                {{ end }}
             </div>
           {{ end }}

           <h4 class="text-xl font-bold text-gray-900 dark:text-white mb-3">
             {{ .title }}
           </h4>
           
           <div class="text-gray-600 dark:text-gray-400 leading-relaxed text-sm flex-grow prose dark:prose-invert">
             {{ .description | markdownify | emojify }}
           </div>
        </div>
      {{ end }}
    </div>
  </div>
  {{ end }}

</div>