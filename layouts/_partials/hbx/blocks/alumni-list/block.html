{{/* Hugo Blox: Alumni List Block with Advanced Alignment */}}

{{ $page := .wcPage }}
{{ $block := .wcBlock }}

{{ $title := $block.content.title | emojify | $page.RenderString }}
{{ $subtitle := $block.content.subtitle | emojify | $page.RenderString }}
{{ $target_groups := $block.content.user_groups }}
{{ $query := slice }}

{{/* 1. 筛选逻辑 */}}
{{ range where site.Pages "Section" "authors" }}
  {{ $author := . }}
  {{ $is_match := false }}
  {{ if $author.Params.user_groups }}
    {{ range $g := $author.Params.user_groups }}
      {{ range $t := $target_groups }}
        {{ if eq (lower (trim (printf "%s" $g) " ")) (lower (trim (printf "%s" $t) " ")) }}
          {{ $is_match = true }}
        {{ end }}
      {{ end }}
    {{ end }}
  {{ end }}
  {{ if $is_match }}
    {{ $query = $query | append $author }}
  {{ end }}
{{ end }}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

  {{/* Header */}}
  <div class="flex flex-col items-center text-center mb-12">
    {{ with $title }}
      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white tracking-tight uppercase">
        {{ . }}
      </h2>
      <div class="h-1 w-16 bg-primary-700 mx-auto mt-4 rounded-full"></div>
    {{ end }}
    {{ with $subtitle }}
      <p class="mt-4 text-xl text-gray-600 dark:text-gray-400">{{ . }}</p>
    {{ end }}
  </div>

  {{/* List Container */}}
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden">
    
    {{/* 表头部分：YEAR居中, NAME居左, DEGREE居左, DESTINATION居左 */}}
    <div class="hidden md:flex items-center bg-gray-100 dark:bg-gray-900 border-b-2 border-primary-600 py-4 px-8 text-base font-bold text-gray-800 dark:text-white uppercase tracking-wider">
      <div class="w-[20%] text-center">Year</div>
      <div class="w-[20%] text-left">Name</div>
      <div class="w-[20%] text-left">Degree</div>
      <div class="w-[40%] text-left">Destination</div>
    </div>

    <div class="divide-y divide-gray-100 dark:divide-gray-700">
      
      {{ if eq (len $query) 0 }}
         <div class="p-8 text-center text-gray-500">
           No alumni found.
         </div>
      {{ else }}

        {{/* 2. 排序逻辑 */}}
        {{ $weighted_list := slice }}
        {{ range $person := $query }}
            {{ $d := lower ($person.Params.degree | default "") }}
            {{ $weight := 99 }}
            {{ if or (in $d "postdoc") (in $d "post-doc") (in $d "博士后") }} {{ $weight = 10 }}
            {{ else if or (in $d "phd") (in $d "ph.d") (in $d "doctor") (in $d "博士") }} {{ $weight = 20 }}
            {{ else if or (in $d "master") (in $d "m.sc") (in $d "ma") (in $d "ms") (in $d "meng") (in $d "硕士") }} {{ $weight = 30 }}
            {{ else if or (in $d "bachelor") (in $d "b.sc") (in $d "ba") (in $d "bs") (in $d "beng") (in $d "本科") (in $d "学士") }} {{ $weight = 40 }}
            {{ end }}
            {{ $item := dict "Page" $person "Weight" $weight "Name" $person.Title "Year" ($person.Params.graduation_year | default "0") }}
            {{ $weighted_list = $weighted_list | append $item }}
        {{ end }}
        {{ $sorted := sort $weighted_list "Name" "asc" }}
        {{ $sorted = sort $sorted "Weight" "asc" }}
        {{ $sorted = sort $sorted "Year" "desc" }}

        {{/* 3. 渲染循环 */}}
        {{ range $item := $sorted }}
            {{ $person := $item.Page }}
            {{ $link := $person.RelPermalink }}
            {{ $year := $person.Params.graduation_year | default "N/A" }}
            {{ $degree := $person.Params.degree | default "" }}
            {{ $destination := $person.Params.destination | default "Unknown" }}

            <div class="group flex flex-col md:flex-row md:items-center py-5 px-8 hover:bg-blue-50/50 dark:hover:bg-gray-700/50 transition-colors duration-200">
              
              {{/* Year - 居中 (20%) */}}
              <div class="w-full md:w-[20%] text-center mb-2 md:mb-0">
                 <span class="inline-block px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-bold rounded text-base font-mono shadow-sm">
                   {{ $year }}
                 </span>
              </div>

              {{/* Name - 居左 (20%) */}}
              <div class="w-full md:w-[20%] flex items-center gap-4 mb-2 md:mb-0 text-left">
                 {{ $avatar := ($person.Resources.ByType "image").GetMatch "*avatar*" }}
                 {{ if $avatar }}
                   {{ $avatar_img := $avatar.Fill "100x100 Center webp" }} 
                   <img src="{{ $avatar_img.RelPermalink }}" class="w-12 h-12 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm shrink-0" loading="lazy">
                 {{ else }}
                   <div class="w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-400 border-2 border-white dark:border-gray-600 shadow-sm overflow-hidden shrink-0">
                      <svg class="w-8 h-8 relative top-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
                      </svg>
                   </div>
                 {{ end }}
                 <a href="{{ $link }}" class="text-base font-bold text-gray-900 dark:text-white hover:text-primary-600 transition-colors truncate">
                   {{ $person.Title }}
                 </a>
              </div>

              {{/* Degree - 居左 (20%) */}}
              <div class="w-full md:w-[20%] text-left mb-1 md:mb-0">
                {{ if $degree }}
                <span class="inline-flex items-center px-3 py-0.5 rounded-full text-base font-medium bg-primary-50 text-primary-800 dark:bg-primary-900 dark:text-primary-200 border border-primary-100 dark:border-primary-800">
                  {{ $degree }}
                </span>
                {{ end }}
              </div>

              {{/* Destination - 居左 (40%) */}}
              <div class="w-full md:w-[40%] text-left pr-2">
                 <div class="flex items-start gap-2 text-gray-700 dark:text-gray-300 text-base">
                   <svg class="w-4 h-4 hidden md:block opacity-70 text-primary-600 shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                   </svg>
                   <span class="font-medium leading-tight">{{ $destination }}</span>
                 </div>
              </div>

            </div>
        {{ end }}
      
      {{ end }}

    </div>
  </div>
</div>